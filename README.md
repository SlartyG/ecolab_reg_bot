# Ecolab Registration Bot

Telegram-бот для регистрации на два типа мероприятий Стартап-студии «ВоронаCreativeTech»: **Акселератор** и **Мероприятия**. Данные сохраняются в Google Sheets. Стек: aiogram 3, gspread.

## Возможности

- **Пользователи:** по команде `/start` — приветствие с контактом поддержки, выбор мероприятия, прохождение анкеты (инлайн-кнопки), сохранение в таблицу. После регистрации можно снова нажать `/start` и зарегистрироваться на второе мероприятие или повторно.
- **Админы:** рассылка по выбранной аудитории (всем / только Акселератор / только Мероприятия), удаление сообщения рассылки у всех (`/delete` в ответ на него), статистика за последний час (`/stats`). Раз в час всем админам приходит отчёт о количестве регистраций за прошедший час.

## Требования

- Python 3.10+
- Google-таблица с двумя листами: **«Мероприятия»** и **«Акселератор»** (заголовки создаёт бот при первой записи)
- Учётные данные: `.env` и `credentials.json` (сервисный аккаунт Google)

## Настройка

1. **Клонировать репозиторий и перейти в каталог.**

2. **Создать виртуальное окружение и установить зависимости:**

```bash
python3 -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

При ошибках SSL при установке:
`pip install --trusted-host pypi.org --trusted-host files.pythonhosted.org -r requirements.txt`

3. **Переменные окружения:** скопировать `env.example` в `.env` и заполнить:

```bash
cp env.example .env
```

- `BOT_TOKEN` — токен от [@BotFather](https://t.me/BotFather)
- `SPREADSHEET_ID` — ID книги из URL таблицы (`.../d/SPREADSHEET_ID/...`)
- `ADMINS_IDS` — ID админов через запятую (необязательно; свой ID: [@userinfobot](https://t.me/userinfobot))
- `SUPPORT_USERNAME` — юзернейм поддержки без `@` (показывается в приветствии при `/start`; по умолчанию: HSEVorona)

4. **Google Sheets:** в корне проекта положить `credentials.json` (ключ сервисного аккаунта). Таблицу с указанным `SPREADSHEET_ID` открыть для этого сервисного аккаунта (по email из ключа).

## Запуск

```bash
python bot.py
```

## Команды

| Команда    | Кто     | Описание |
|------------|--------|----------|
| `/start`   | Все    | Приветствие, контакт поддержки, выбор мероприятия и регистрация |
| `/send`    | Админы | Рассылка (выбор аудитории → ввод текста) |
| `/stats`   | Админы | Статистика регистраций за последний час (для проверки) |
| `/delete`  | Админы | Ответом на сообщение рассылки — удалить его у всех получателей |

Раз в час админам автоматически приходит отчёт: количество регистраций на Мероприятия и Акселератор за прошедший час.

## Структура проекта

```
├── bot.py              # Точка входа, ежечасная рассылка статистики админам
├── config.py           # Конфиг из .env и константы
├── handlers/
│   ├── registration.py # Регистрация (оба мероприятия)
│   └── admin.py        # Рассылка, /stats, /delete
├── services/
│   ├── sheets.py       # Google Sheets: запись, user_id по листам, статистика за час
│   └── broadcaster.py  # (не используется)
├── utils/
│   ├── states.py       # FSM-состояния
│   └── validators.py   # Валидация email, контакта, URL
├── env.example
├── requirements.txt
└── README.md
```

Файлы `.env` и `credentials.json` в репозиторий не попадают (см. `.gitignore`).
